interpreter: bash -c
usage: arenactl
options:
  launchdir:
    # this is a go-tusk quirk
    environment: PWD

  contracts-dir:
    default: ../chaintrap-contracts

  THIS_TUSK:
    default: "tusk -qf tusk-arena.yml"

  CONTRACTS_DEVTOOL:
    default: "tusk -qf ../chaintrap-contracts/tusk.yml"

  deploy-key:
    default:
      command: cat .local/dev/wallets/wallet-deploy.key

  libdeploy-key:
    default:
      command: cat .local/dev/wallets/libdeploy.key

  depdir:
    usage: the directory to store deployment json files in
    default: ./.local/dev/deployed

  deploy-gaslimit:
    default: 3000000
  deploy-caimst-url:
    default: https://chains.hoy.polysensus.io/chains/caimst-209301/node/ethnode0/WWdEOHJUNVFDRXpPZ0VDb1IxTVpYOmFyZ29uMmlkIDMgNjRNQiAzMi5Kdkt6cEU5U09HNW02a3RBXzViYk8yRFZNeUw3cXBEdm5vQjhlOEtQMk5rPS5pR2JMMXpDRzBxbVRKdnRUN2RkLURxWlhSbDkxTWlYQm1RNDlKVzhjOF9jPQ==
  deploy-polygon-mumbai-url:
    default: https://polygon-mumbai.g.alchemy.com/v2/zyiZCXLwVEOZPVoixfOBBVvp7KE1oiqf
  deploy-hh-url:
    default: http://localhost:8545
  deploy-hh-private-key:
    # the private key for hh is well known
    default: "0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80"
  deploy-hh-account:
    default: "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266"

tasks:
  deploy-all:
    run:
      - task: deploy-caimst
      - task: deploy-polygon

  deploy-polygon:
    run:
      task:
        name: deploy-arena
        options:
          rpc: ${deploy-polygon-mumbai-url}
          deploy-key: ${deploy-key}

  deploy-polygon-diamond:
    run:
      task:
        name: deploy-arena-diamond
        options:
          rpc: ${deploy-polygon-mumbai-url}
          deploy-key: ${deploy-key}

  deploy-caimst:
    run:
      task:
        name: deploy-arena
        options:
          rpc: ${deploy-caimst-url}
          deploy-key: ${deploy-key}

  deploy-libs-caimst:
    run:
      task:
        name: deploy-libs
        options:
          rpc: ${deploy-caimst-url}
          deploy-key: ${deploy-key}
          chain: caimst

  deploy-libs-polygon:
    run:
      task:
        name: deploy-libs
        options:
          rpc: ${deploy-polygon-mumbai-url}
          deploy-key: ${deploy-key}
          chain: polygon

  deploy-hh:
    run:
      task:
        name: deploy-arena
        options:
          rpc: ${deploy-hh-url}
          deploy-key: hardhat:10
          owner-key: hardhat

  deploy-arena:
    options:
      rpc:
      deploy-key:
      owner-key:
    run:
      - command:
          exec: |
            set -e

            npx diamond-deploy list \
              -I facet -n Diamond DiamondNew \
              -i node_modules/@polysensus/chaintrap-contracts/abi \
              --format json -x node_modules/@polysensus/chaintrap-contracts/abi/facets-exclude.json \
              | tee diamond-deploy.json

            npx diamond-deploy \
              -u "${rpc}" \
              -d "${deploy-key}" \
              diamond-new \
              --diamond-owner-key ${owner-key} \
              --diamond-name Diamond \
              --diamond-cut-name DiamondCutFacet \
              --diamond-init-name DiamondNew \
              --diamond-init-args \
                '[{"typeURIs": ["GAME_TYPE", "TRANSCRIPT_TYPE", "FURNITURE_TYPE"]}]' \
              -f diamond-deploy.json